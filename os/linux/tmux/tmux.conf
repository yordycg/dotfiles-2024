# source-file "$DOTFILES/os/linux/tmux/tmux.reset.conf"
source-file "$DOTFILES/os/linux/tmux/tmux.reset.conf"

# Use zsh as default shell
# set -g default-shell /bin/zsh
set -g default-shell /home/linuxbrew/.linuxbrew/bin/fish

# Enable 256-color and true-color (24-bit) support in tmux
set -g default-terminal 'screen-256color'
set -ga terminal-overrides ',*256col*:Tc'
# set-option -a terminal-features 'xterm-256color:RGB'

# General
#----------------------------------------------------------------------------------------------------------------------
# True colors support
# set -g default-terminal 'screen-256color'   # enable 256-color and ture-color (24-bit) support in tmux
set -g default-terminal "${TERM}"
set -ga terminal-overrides ",*:RGB"

set -g default-shell /bin/zsh               # use zsh as default shell
set -g set-clipboard on                     # use system clipboard
set -g mouse on                             # enable mouse support
set -g status-interval 3                    # update the status bar every 3 seconds (default: 15)
set -g detach-on-destroy off                # don't exit from tmux when closing a session
set -g escape-time 0                       # zero-out escape time delay => 0 - linux | 50ms - windows
set -g history-limit 1000000                # increase history size (from 2.000)
set -g renumber-windows on                  # renumbet all windows when any window is closed
set -g automatic-rename off                 # rename window automatic
setw -g mode-keys vi                        # enable vi mode to allow vim movements
set -g status-position top                  # move status bar in top position
set -g base-index 1                         # start indexing windows at 1 instead of 0
set -g pane-base-index 1                    # start indexing panes at 1 instead of 0
set -g renumber-windows on                  # automatically renumber windows when one is closed

# TEST: pasar multiples comandos a tmux sin usar el prefix
set -g repeat-time 1000

#----------------------------------------------------------------------------------------------------------------------
# Image Preview
# - Enable image preview in tmux session
#----------------------------------------------------------------------------------------------------------------------
set -gg allow-passthrough all
set -g visual-activity off
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM

#----------------------------------------------------------------------------------------------------------------------
# Set prefix key
#----------------------------------------------------------------------------------------------------------------------
unbind C-b                                  # unbin default prefix key
set -g prefix C-Space                       # prefix key now Ctrl+Space
# set -g prefix C-s                           # prefix key now Ctrl+S

#----------------------------------------------------------------------------------------------------------------------
# Load theme
#----------------------------------------------------------------------------------------------------------------------
# NOTE: To apply theme changes: tmux kill-server && rm -rf /tmp/tmux-*
if-shell 'test "$TMUX_THEME" = "onedark"' 'source-file ~/.config/tmux/themes/onedark.conf'
if-shell 'test "$TMUX_THEME" = "nord"' 'source-file ~/.config/tmux/themes/nord.conf'
if-shell 'test "$TMUX_THEME" = "minimalist"' 'source-file ~/.config/tmux/themes/minimalist.conf'
if-shell 'test "$TMUX_THEME" = "adib-hanna"' 'source-file ~/.config/tmux/themes/adib-hanna.conf'

#----------------------------------------------------------------------------------------------------------------------
# Config status bar
#----------------------------------------------------------------------------------------------------------------------
# STATUS_FORMAT="#(echo '#{pane_current_path}' | $DOTFILES/os/linux/tmux/current-path.sh)"
# GITMUX="#(gitmux -cfg $DOTFILES/os/linux/tmux/gitmux.conf)"
# TIME_FORMAT="%I:%M %p"
#
# STATUS_OPEN="#[fg=${BG_COLOR},bg=default]#[fg=${FG_COLOR},bg=${BG_COLOR}]"
# STATUS_CLOSE="#[fg=${BG_COLOR},bg=default]"
#
# WINDOW_FORMAT="#I"
# ACTIVE_WINDOW_FORMAT="#{?window_zoomed_flag, ,} #I"
#
# WINDOW_STATUS_OPEN="#[fg=${BG_LIGHT},bg=default]#[fg=${FG_COLOR},bg=${BG_LIGHT}]"
# WINDOW_STATUS_CLOSE=" #[fg=${FG_COLOR},bg=${BG_LIGHT}]${WINDOW_FORMAT}#[fg=${BG_LIGHT},bg=default]"
#
# ACTIVE_WINDOW_STATUS_OPEN="#[fg=${BG_LIGHT},bg=default]#[fg=${FG_COLOR},bg=${BG_LIGHT}]"
# ACTIVE_WINDOW_STATUS_CLOSE=" #[fg=${BG_LIGHT},bg=${BG_ACCENT}]${ACTIVE_WINDOW_FORMAT}#[fg=${BG_ACCENT},bg=default]"
#
# set -g status-left "${STATUS_OPEN}${STATUS_FORMAT}${STATUS_CLOSE} ${GITMUX}"
# set -g status-left-length 200
# set -g status-right "${STATUS_OPEN}${TIME_FORMAT}${STATUS_CLOSE}"
# set -g status-bg default
# set -g status-style bg=default
#
# set -g window-status-current-format "${ACTIVE_WINDOW_STATUS_OPEN}#W${ACTIVE_WINDOW_STATUS_CLOSE}"
# set -g window-status-format "${WINDOW_STATUS_OPEN}#W${WINDOW_STATUS_CLOSE}"
# set -g message-command-style bg=default,fg=yellow
# set -g message-style bg=default,fg=yellow
# set -g mode-style bg=default,fg=yellow
# set -g pane-active-border-style "fg=${BG_ACCENT},bg=default"
# set -g pane-border-style "fg=${BG_LIGHT},bg=default"

#----------------------------------------------------------------------------------------------------------------------
# List of plugins
#----------------------------------------------------------------------------------------------------------------------
set -g @plugin 'tmux-plugins/tpm'                           # load tpm

set -g @plugin 'tmux-plugins/tmux-sensible'                 # Config basica de sensibles
set -g @plugin 'tmux-plugins/tmux-resurrect'                # Guarda/restaura sesiones despues del reinicio del computador
set -g @plugin 'tmux-plugins/tmux-continuum'                # Auto-guarda sesiones cada 15 minutos
set -g @plugin 'sainnhe/tmux-fzf'                           # Integracion con fzf
set -g @plugin 'christoomey/vim-tmux-navigator'             # Navegacion perfecta con vim | <ctrl> + hjkl | necesitamos instalar en nvim
# set -g @plugin 'catppuccin/tmux#v2.1.2'                   # Tema Catppuccin
set -g @plugin 'tmux-plugins/tmux-yank'                     # Mejora el copiado
set -g @plugin 'tmux-plugins/tmux-pain-control'             # Mejor control de paneles
set -g @plugin 'jaclu/tmux-menus'                           # Menus popup
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'         # Indica cuando prefix esta activo
set -g @plugin 'omerxx/tmux-sessionx'                       # Gestionar sesiones con fzf
set -g @plugin 'joshmedeski/t-smart-tmux-session-manager'   #
set -g @plugin 'tmux-plugins/tmux-sessionist'               # Manegar sessions
set -g @plugin 'wfxr/tmux-fzf-url'

set -g @tmux-fzf-launch-key 'F' # prefix+F
set -g @fzf-url-fzf-options '-p 70%,50% --prompt="" --border-label=" Open URL "'
set -g @fzf-url-history-limit '2000'

set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '10'
set -g @sessionx-bind 'o'
set -g @sessionx-zoxide-mode 'on'

# Automatic tpm installation
if "test ! -d $DOTFILES/os/linux/tmux/plugins/tmp" \
    "run 'git clone https://github.com/tmux-plugins/tpm ~/.config/tmux/plugins/tpm && ~/.config/tmux/plugins/tpm/bin/install_plugins'"

run "~/.config/tmux/plugins/tpm/tpm"  # run tpm (always end of line) | run with prefix + I
