source-file "$DOTFILES/os/linux/tmux/tmux.reset.conf"
set -g default-terminal 'tmux-256color'
set-option -a terminal-features 'xterm-256color:RGB'
# set-option -g default-terminal 'screen-254color'
# set-option -g terminal-overrides ',xterm-256color:RGB'

set -g prefix C-s                           # set leader
set -g base-index 1                         # start indexing windows at 1 instead of 0
set -g detach-on-destroy off                # don't exit from tmux when closing a session
set -g escape-time 50                       # zero-out escape time delay - linux | 50ms - windows
set -g history-limit 1000000                # increase history size (from 2.000)
set -g mouse on                             # enable mouse support
set -g renumber-windows on                  # renumbet all windows when any window is closed
set -g set-clipboard on                     # use system clipboard
set -g status-interval 3                    # update the status bar every 3 seconds
set -g status-position top                  # macOS / darwin style
set -g automatic-rename off                 # rename window automatic 
set -g renumber-windows on                  # renum windows when one closed
set -g default-terminal "${TERM}"
setw -g mode-keys vi

# Config status bar --------------------------------------------------------------
# FG_COLOR="#c5c9c5"
# BG_COLOR="#1D1C19"
# BG_LIGHT="#282727"
# BG_ACCENT="#8ea4a2"

STATUS_FORMAT="#(echo '#{pane_current_path}' | $DOTFILES/os/linux/tmux/current-path.sh)"
GITMUX="#(gitmux -cfg $DOTFILES/os/linux/tmux/gitmux.conf)"
TIME_FORMAT="%I:%M %p"

STATUS_OPEN="#[fg=${BG_COLOR},bg=default]#[fg=${FG_COLOR},bg=${BG_COLOR}]"
STATUS_CLOSE="#[fg=${BG_COLOR},bg=default]"

WINDOW_FORMAT="#I"
ACTIVE_WINDOW_FORMAT="#{?window_zoomed_flag, ,} #I"

WINDOW_STATUS_OPEN="#[fg=${BG_LIGHT},bg=default]#[fg=${FG_COLOR},bg=${BG_LIGHT}]"
WINDOW_STATUS_CLOSE=" #[fg=${FG_COLOR},bg=${BG_LIGHT}]${WINDOW_FORMAT}#[fg=${BG_LIGHT},bg=default]"

ACTIVE_WINDOW_STATUS_OPEN="#[fg=${BG_LIGHT},bg=default]#[fg=${FG_COLOR},bg=${BG_LIGHT}]"
ACTIVE_WINDOW_STATUS_CLOSE=" #[fg=${BG_LIGHT},bg=${BG_ACCENT}]${ACTIVE_WINDOW_FORMAT}#[fg=${BG_ACCENT},bg=default]"

set -g status-left "${STATUS_OPEN}${STATUS_FORMAT}${STATUS_CLOSE} ${GITMUX}"
set -g status-left-length 200
set -g status-right "${STATUS_OPEN}${TIME_FORMAT}${STATUS_CLOSE}"
set -g status-bg defualt
set -g status-style bg=default

set -g window-status-current-format "${ACTIVE_WINDOW_STATUS_OPEN}#W${ACTIVE_WINDOW_STATUS_CLOSE}"
set -g window-status-format "${WINDOW_STATUS_OPEN}#W${WINDOW_STATUS_CLOSE}"
set -g message-command-style bg=default,fg=yellow
set -g message-style bg=default,fg=yellow
set -g mode-style bg=default,fg=yellow
set -g pane-active-border-style "fg=${BG_ACCENT},bg=default"
set -g pane-border-style "fg=${BG_LIGHT},bg=default"

# Enable image preview in tmux session -------------------------------------------
set -gg allow-passthrough all
set -g visual-activity off
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM

# List of plugins ----------------------------------------------------------------
set -g @plugin 'tmux-plugins/tpm'                   # load tpm
set -g @plugin 'tmux-plugins/tmux-sensible'         # Config basica de sensibles
set -g @plugin 'tmux-plugins/tmux-resurrect'        # Guarda/restaura sesiones
set -g @plugin 'tmux-plugins/tmux-continuum'        # Auto-guarda sesiones
set -g @plugin 'sainnhe/tmux-fzf'                   # Integracion con fzf
set -g @plugin 'christoomey/vim-tmux-navigator'     # Navegacion perfecta con vim | <ctrl> + hjkl
# set -g @plugin 'catppuccin/tmux#v2.1.2'             # Tema Catppuccin

set -g @plugin 'tmux-plugins/tmux-yank'             # Mejora el copiado
set -g @plugin 'tmux-plugins/tmux-pain-control'     # Mejor control de paneles
set -g @plugin 'jaclu/tmux-menus'                   # Menus popup
set -g @plugin 'tmux-plugins/tmux-prefix-highlight' # Indica cuando prefix esta activo
set -g @plugin 'omerxx/tmux-sessionx'               # Gestionar sesiones con fzf

set -g @plugin 'fcsonline/tmux-thumbs'
set -g @plugin 'wfxr/tmux-fzf-url'

set -g @tmux-fzf-launch-key 'f'
set -g @fzf-url-fzf-options '-p 60%,30% --prompt="" --border-label=" Open URL "'
set -g @fzf-url-history-limit '2000'

set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '10'
set -g @sessionx-bind 'o'
set -g @sessionx-zoxide-mode 'on'

# Config catppuccin
# set -g @catppuccin_flavor 'mocha' # latte | frappe | mocchiato | mocha
# set -g @catppuccin_window_status_style 'rounded' # basic | rounded | slanted | custom | none

# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Configuración de formato de ventanas

# set -g @catppuccin_window_default_text "#{b:?#{e|>=:#{w:pane_current_path},3},#{e|split:#{w:pane_current_path},/,-2}/../#{b:pane_current_path},#{b:pane_current_path}}"
# set -g @catppuccin_window_current_text "#{b:?#{e|>=:#{w:pane_current_path},3},#{e|split:#{w:pane_current_path},/,-2}/../#{b:pane_current_path},#{b:pane_current_path}}"

# set -g @catppuccin_window_left_separator ""
# set -g @catppuccin_window_right_separator " "
# set -g @catppuccin_window_middle_separator " "
# set -g @catppuccin_window_number_position "left"
#
# set -g @catppuccin_window_default_fill "number"
# set -g @catppuccin_window_current_fill "number"
#
# set -g @catppuccin_window_default_text "#{b:?#{e|>=:#{w:pane_current_path},3},#{e|split:#{w:pane_current_path},/,-2}/../#{b:pane_current_path},#{b:pane_current_path}}"
# set -g @catppuccin_window_current_text "#{b:?#{e|>=:#{w:pane_current_path},3},#{e|split:#{w:pane_current_path},/,-2}/../#{b:pane_current_path},#{b:pane_current_path}}"

# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

# set -g status-right-length 100
# set -g status-left-length 100
# set -g status-left ""
# set -g status-right "#{E:@catppuccin_status_application}"
# set -agF status-right "#{E:@catppuccin_status_cpu}"
# set -ag status-right "#{E:@catppuccin_status_session}"
# set -ag status-right "#{E:@catppuccin_status_uptime}"
# set -agF status-right "#{E:@catppuccin_status_battery}"

# Automatic tpm installation
if "test ! -d $DOTFILES/os/linux/tmux/plugins/tmp" \
    "run 'git clone https://github.com/tmux-plugins/tpm ~/.config/tmux/plugins/tpm && ~/.config/tmux/plugins/tpm/bin/install_plugins'"
# if "test ! -d ~/.config/tmux/plugins/tmp" \
#     "run 'git clone https://github.com/tmux-plugins/tpm ~/.config/tmux/plugins/tpm && ~/.config/tmux/plugins/tpm/bin/install_plugins'"

# Reload config and change theme
bind T command-prompt -p "Theme:" \
    "source-file $DOTFILES/os/linux/tmux/themes/%1.conf \; source-file $DOTFILES/os/linux/tmux/tmux.conf"

run "~/.config/tmux/plugins/tpm/tpm"  # run tpm (always end of line) | run with prefix + I
